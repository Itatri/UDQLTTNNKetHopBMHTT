CREATE TABLE HOCVIEN
(
    MAHV CHAR(15) NOT NULL,
    HOTENHV NVARCHAR2(50),
    GIOITINH NVARCHAR2(5),
    DIACHI NVARCHAR2(50),
    EMAIL CHAR(50),
    SDT CHAR(10),
    CONSTRAINT PK_HOCVIEN PRIMARY KEY (MAHV)
);


CREATE TABLE LOPHOCPHAN
(
    MALOPHP CHAR(15) NOT NULL,
    TENLOPHP NVARCHAR2(50),
    TENKHOA NVARCHAR2(50),
    NGAYKHAIGIANG DATE,
    NGAYKT DATE,
    LICHHOC NVARCHAR2(50),
    SISO NUMBER,
    HOCPHI NUMBER,
    CONSTRAINT PK_LOPHOCPHAN PRIMARY KEY (MALOPHP)
);

CREATE TABLE DIEMDANH
(
    NGAYVANG TIMESTAMP NOT NULL,
    MAHV CHAR(15) NOT NULL,
    MALOPHP CHAR(15),
    CONSTRAINT PK_DIEMDANH PRIMARY KEY (MAHV, NGAYVANG),
    CONSTRAINT FK_DIEMDANH_HOCVIEN FOREIGN KEY (MAHV) REFERENCES HOCVIEN(MAHV),
    CONSTRAINT FK_DIEMDANH_LOPHOCPHAN FOREIGN KEY (MALOPHP) REFERENCES LOPHOCPHAN(MALOPHP)
);


CREATE TABLE HOCTAP
(
    MABT CHAR(15) NOT NULL,
    MAHV CHAR(15) NOT NULL,
    DIEM NUMBER,
    DIEMTOIDA NUMBER,
    MALOPHP CHAR(15),
    CONSTRAINT PK_HOCTAP PRIMARY KEY (MABT, MAHV),
    CONSTRAINT FK_HOCTAP_HOCVIEN FOREIGN KEY (MAHV) REFERENCES HOCVIEN(MAHV),
    CONSTRAINT FK_HOCTAP_LOPHOCPHAN FOREIGN KEY (MALOPHP) REFERENCES LOPHOCPHAN(MALOPHP)
);


CREATE TABLE PHANLOP
(
    MALOPHP CHAR(15) NOT NULL,
    MAHV CHAR(15) NOT NULL,
    CONSTRAINT PK_PHANLOP PRIMARY KEY (MALOPHP, MAHV),
    CONSTRAINT FK_PHANLOP_HOCVIEN FOREIGN KEY (MAHV) REFERENCES HOCVIEN(MAHV),
    CONSTRAINT FK_PHANLOP_LOPHOCPHAN FOREIGN KEY (MALOPHP) REFERENCES LOPHOCPHAN(MALOPHP)
);

CREATE TABLE GIAOVIEN
(
    MAGV CHAR(15) NOT NULL,
    TENGV NVARCHAR2(50),
    TENTKGV CHAR(30),
    MATKHAU CHAR(20),
    CONSTRAINT PK_GIAOVIEN PRIMARY KEY (MAGV)
);

CREATE TABLE PHANCONG
(
    MAGV CHAR(15) NOT NULL,
    MALOPHP CHAR(15) NOT NULL,
    CONSTRAINT PK_PHANCONG PRIMARY KEY (MAGV, MALOPHP),
    CONSTRAINT FK_PHANCONG_LOPHOCPHAN FOREIGN KEY (MALOPHP) REFERENCES LOPHOCPHAN(MALOPHP),
    CONSTRAINT FK_PHANCONG_GIAOVIEN FOREIGN KEY (MAGV) REFERENCES GIAOVIEN(MAGV)
);


CREATE TABLE KHUYENMAI
(
    MAKM CHAR(15) NOT NULL,
    SOHVNHOM NUMBER,
    SOTIENGIAM NUMBER,
    CONSTRAINT PK_KHUYENMAI PRIMARY KEY (MAKM)
);


CREATE TABLE NHANVIEN
(
    TENTKNV CHAR(30) NOT NULL,
    MATKHAU VARCHAR(20),
    EMAIL   VARCHAR(30),
    SDT     VARCHAR(20),
    CONSTRAINT PK_NHANVIEN PRIMARY KEY (TENTKNV)
);

CREATE TABLE HOADON
(
    MAHD CHAR(15) NOT NULL,
    MAHV CHAR(15),
    NGAYLAP TIMESTAMP,
    MALOPHP CHAR(15),
    MAKM CHAR(15),
    TENTKNV CHAR(30),
    THANHTIEN NUMBER,
    CONSTRAINT PK_HOADON PRIMARY KEY (MAHD),
    CONSTRAINT FK_HOADON_HOCVIEN FOREIGN KEY (MAHV) REFERENCES HOCVIEN(MAHV),
    CONSTRAINT FK_HOADON_LOPHOCPHAN FOREIGN KEY (MALOPHP) REFERENCES LOPHOCPHAN(MALOPHP),
    CONSTRAINT FK_HOADON_KHUYENMAI FOREIGN KEY (MAKM) REFERENCES KHUYENMAI(MAKM),
    CONSTRAINT FK_HOADON_NHANVIEN FOREIGN KEY (TENTKNV) REFERENCES NHANVIEN(TENTKNV)
);

--=========================================================== DỮ LIỆU ==========================================================

INSERT INTO HOCVIEN VALUES ('HV001', N'Trương Lê Bảo Trân', N'Nữ', N'Long An', 'truonglebaotran2201@gmail.com', '0916649072');
INSERT INTO HOCVIEN VALUES ('HV002', N'Phan Trần Minh Tâm', N'Nữ', N'Tây Ninh', 'phantranminhtam1802@gmail.com', '0987138914');
INSERT INTO HOCVIEN VALUES ('HV003', N'Phan Thế Thanh', N'Nam', N'TPHCM', 'phanthethanh0209@gmail.com', '0928366736');
INSERT INTO HOCVIEN VALUES ('HV004', N'Nguyễn Minh Trí', N'Nam', N'Bến Tre', 'nguyenminhtri2404@gmail.com', '0928723561');
INSERT INTO HOCVIEN VALUES ('HV005', N'Lê Viết Tuấn Khải', N'Nam', N'Củ Chi', 'leviettuankhai1002@gmail.com', '0928163618');
INSERT INTO HOCVIEN VALUES ('HV006', N'Hồ Minh Quang', N'Nam', N'Bến Tre', 'hominhquang2903@gmail.com', '0923588195');
INSERT INTO HOCVIEN VALUES ('HV007', N'Hoàng Thị Trường An', N'Nữ', N'Long An', 'hoangthitruongan0211@gmail.com', '0917298137');

INSERT INTO LOPHOCPHAN VALUES ('HP001', N'TOEIC 2 Kỹ Năng 500+ T357', N'TOEIC', TO_DATE('2022-02-15', 'YYYY-MM-DD'), TO_DATE('2022-05-14', 'YYYY-MM-DD'), N'T357 19h45-21h15', 20, 3900000);
INSERT INTO LOPHOCPHAN VALUES ('HP002', N'TOEIC 4 Kỹ Năng 500+ T246', N'TOEIC', TO_DATE('2023-07-03', 'YYYY-MM-DD'), TO_DATE('2023-10-01', 'YYYY-MM-DD'), N'T246 18h-19h30', 20, 8700000);
INSERT INTO LOPHOCPHAN VALUES ('HP003', N'IELTS 4.0 T246', N'IELTS', TO_DATE('2023-04-03', 'YYYY-MM-DD'), TO_DATE('2023-07-03', 'YYYY-MM-DD'), N'T246 18h-19h30', 20, 4000000);
INSERT INTO LOPHOCPHAN VALUES ('HP004', N'IELTS 4.0- 7.5+ T357', N'IELTS', TO_DATE('2023-08-15', 'YYYY-MM-DD'), TO_DATE('2023-12-30', 'YYYY-MM-DD'), N'T357 19h45-21h15', 10, 10500000);
INSERT INTO LOPHOCPHAN VALUES ('HP005', N'HSK3+ HSKK T7CN', N'HSK', TO_DATE('2023-10-21', 'YYYY-MM-DD'), TO_DATE('2023-12-21', 'YYYY-MM-DD'), N'T7CN 9h-11h', 20, 3200000);
INSERT INTO LOPHOCPHAN VALUES ('HP006', N'Tiếng Trung giao tiếp', N'Tiếng Trung', TO_DATE('2024-01-22', 'YYYY-MM-DD'), TO_DATE('2024-04-10', 'YYYY-MM-DD'), N'T7CN 9h-11h', 20, 3200000);
INSERT INTO LOPHOCPHAN VALUES ('HP007', N'Tiếng Anh giao tiếp', N'Tiếng Anh', TO_DATE('2023-12-24', 'YYYY-MM-DD'), TO_DATE('2024-04-12', 'YYYY-MM-DD'), N'T246 18h-19h30', 20, 3200000);


INSERT INTO HOCTAP VALUES ('BTHP001_001', 'HV001', 80, 100, 'HP001');
INSERT INTO HOCTAP VALUES ('BTHP001_001', 'HV002', NULL, 100, 'HP001');
INSERT INTO HOCTAP VALUES ('BTHP001_002', 'HV001', 50, 100, 'HP001');
INSERT INTO HOCTAP VALUES ('BTHP001_002', 'HV002', 70, 100, 'HP001');

INSERT INTO HOCTAP VALUES ('BTHP004_001', 'HV003', 85, 100, 'HP004');
INSERT INTO HOCTAP VALUES ('BTHP004_002', 'HV004', 90, 100, 'HP004');
INSERT INTO HOCTAP VALUES ('BTHP006_001', 'HV001', 75, 100, 'HP006');
INSERT INTO HOCTAP VALUES ('BTHP006_001', 'HV005', NULL, 100, 'HP006');
INSERT INTO HOCTAP VALUES ('BTHP007_001', 'HV002', 88, 100, 'HP007');
INSERT INTO HOCTAP VALUES ('BTHP007_001', 'HV006', 76, 100, 'HP007');

INSERT INTO DIEMDANH VALUES (TO_TIMESTAMP('2023-10-30 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'HV001', 'HP001');
INSERT INTO DIEMDANH VALUES (TO_TIMESTAMP('2023-10-30 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'HV002', 'HP001');
INSERT INTO DIEMDANH VALUES (TO_TIMESTAMP('2023-10-30 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'HV003', 'HP001');
INSERT INTO DIEMDANH VALUES (TO_TIMESTAMP('2023-10-30 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'HV004', 'HP002');
INSERT INTO DIEMDANH VALUES (TO_TIMESTAMP('2023-10-30 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'HV005', 'HP002');
INSERT INTO DIEMDANH VALUES (TO_TIMESTAMP('2023-10-30 08:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'HV006', 'HP003');

INSERT INTO PHANLOP VALUES ('HP001', 'HV001');
INSERT INTO PHANLOP VALUES ('HP001', 'HV002');
INSERT INTO PHANLOP VALUES ('HP002', 'HV003');
INSERT INTO PHANLOP VALUES ('HP002', 'HV004');
INSERT INTO PHANLOP VALUES ('HP003', 'HV005');
INSERT INTO PHANLOP VALUES ('HP004', 'HV006');
INSERT INTO PHANLOP VALUES ('HP005', 'HV007');

INSERT INTO GIAOVIEN VALUES ('GV001', N'Nguyễn Văn A', 'nguyenvana', 'password123');
INSERT INTO GIAOVIEN VALUES ('GV002', N'Trần Thị B', 'tranthib', 'password123');
INSERT INTO GIAOVIEN VALUES ('GV003', N'Phạm Minh C', 'phamminhc', 'password123');

INSERT INTO PHANCONG VALUES ('GV001', 'HP001');
INSERT INTO PHANCONG VALUES ('GV002', 'HP002');
INSERT INTO PHANCONG VALUES ('GV003', 'HP003');

INSERT INTO KHUYENMAI VALUES ('KM001', 10, 500000);
INSERT INTO KHUYENMAI VALUES ('KM002', 20, 2000000);

INSERT INTO NHANVIEN VALUES ('NV001','password123','nv001@gmail.com','0977421521');

INSERT INTO HOADON VALUES ('HD001', 'HV001', TO_TIMESTAMP('2023-10-30 10:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'HP001', 'KM001', 'NV001', 3900000);
INSERT INTO HOADON VALUES ('HD002', 'HV002', TO_TIMESTAMP('2023-10-30 10:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'HP002', 'KM002', 'NV001', 8700000);
INSERT INTO HOADON VALUES ('HD003', 'HV003', TO_TIMESTAMP('2023-10-31 09:30:00', 'YYYY-MM-DD HH24:MI:SS'), 'HP003', NULL, 'NV001', 500000);
INSERT INTO HOADON VALUES ('HD004', 'HV004', TO_TIMESTAMP('2023-11-01 08:45:00', 'YYYY-MM-DD HH24:MI:SS'), 'HP001', 'KM001', 'NV001', 2700000);
INSERT INTO HOADON VALUES ('HD005', 'HV005', TO_TIMESTAMP('2023-11-02 14:00:00', 'YYYY-MM-DD HH24:MI:SS'), 'HP002', NULL, 'NV001', 3000000);
INSERT INTO HOADON VALUES ('HD006', 'HV006', TO_TIMESTAMP('2023-11-03 15:30:00', 'YYYY-MM-DD HH24:MI:SS'), 'HP003', 'KM002', 'NV001', 600000);

SELECT * FROM HOCVIEN;
SELECT * FROM LOPHOCPHAN;
SELECT * FROM HOCTAP;
SELECT * FROM DIEMDANH;
SELECT * FROM PHANLOP;
SELECT * FROM GIAOVIEN;
SELECT * FROM PHANCONG;
SELECT * FROM KHUYENMAI;
SELECT * FROM NHANVIEN;
SELECT * FROM HOADON;
SELECT * FROM USER_SYS_PRIVS WHERE PRIVILEGE LIKE '%PROCEDURE%';

DELETE FROM HOADON;
DELETE FROM KHUYENMAI;
DELETE FROM PHANCONG;
DELETE FROM PHANLOP;
DELETE FROM HOCTAP;
DELETE FROM DIEMDANH;
DELETE FROM HOCVIEN;
DELETE FROM GIAOVIEN;
DELETE FROM NHANVIEN;
DELETE FROM LOPHOCPHAN;

--==///Thực hiện tạo và gán quyền thao tác trên Schema DuLieu cho các người dùng//==--
GRANT SELECT ON HOCVIEN TO RoleGV;
GRANT SELECT, INSERT, UPDATE ON DIEMDANH TO RoleGV;
GRANT SELECT ON HOCTAP TO RoleGV;
GRANT SELECT ON LOPHOCPHAN TO RoleGV;
GRANT SELECT ON GIAOVIEN TO RoleGV;
GRANT SELECT ON PHANLOP TO RoleGV;
Grant SELECT ON PHANCONG TO RoleGV;
GRANT CREATE SESSION TO RoleGV;
---====NHANVIEN====---
-- Cấp quyền cho Role
GRANT CREATE SESSION TO RoleNV;

GRANT SELECT ON HOCVIEN TO RoleNV;
GRANT INSERT ON HOCVIEN TO RoleNV;
GRANT UPDATE ON HOCVIEN TO RoleNV;
GRANT DELETE ON HOCVIEN TO RoleNV;

GRANT SELECT ON GIAOVIEN TO RoleNV;
GRANT INSERT ON GIAOVIEN TO RoleNV;
GRANT UPDATE ON GIAOVIEN TO RoleNV;
GRANT DELETE ON GIAOVIEN TO RoleNV;

GRANT SELECT ON NHANVIEN TO RoleNV;
GRANT INSERT ON NHANVIEN TO RoleNV;
GRANT UPDATE ON NHANVIEN TO RoleNV;
GRANT DELETE ON NHANVIEN TO RoleNV;

GRANT SELECT ON HOADON TO RoleNV;
GRANT INSERT ON HOADON TO RoleNV;
GRANT UPDATE ON HOADON TO RoleNV;
GRANT DELETE ON HOADON TO RoleNV;

GRANT SELECT ON KHUYENMAI TO RoleNV;
GRANT INSERT ON KHUYENMAI TO RoleNV;
GRANT UPDATE ON KHUYENMAI TO RoleNV;
GRANT DELETE ON KHUYENMAI TO RoleNV;

GRANT SELECT ON PHANCONG TO RoleNV;
GRANT INSERT ON PHANCONG TO RoleNV;
GRANT UPDATE ON PHANCONG TO RoleNV;
GRANT DELETE ON PHANCONG TO RoleNV;

GRANT SELECT ON PHANLOP TO RoleNV;
GRANT INSERT ON PHANLOP TO RoleNV;
GRANT UPDATE ON PHANLOP TO RoleNV;
GRANT DELETE ON PHANLOP TO RoleNV;

GRANT SELECT ON DIEMDANH TO RoleNV;
GRANT INSERT ON DIEMDANH TO RoleNV;
GRANT UPDATE ON DIEMDANH TO RoleNV;
GRANT DELETE ON DIEMDANH TO RoleNV;

GRANT SELECT ON LOPHOCPHAN TO RoleNV;
GRANT INSERT ON LOPHOCPHAN TO RoleNV;
GRANT UPDATE ON LOPHOCPHAN TO RoleNV;
GRANT DELETE ON LOPHOCPHAN TO RoleNV;

GRANT RoleGV TO GiaoVien01;
SELECT GRANTED_ROLE FROM user_role_privs WHERE username = 'GiaoVien01';

ALTER TABLE DuLieu.GIAOVIEN MODIFY TENTKGV VARCHAR2(4000 BYTE);
ALTER TABLE DuLieu.GIAOVIEN MODIFY MATKHAU VARCHAR2(4000 BYTE);

ALTER TABLE DuLieu.HOCVIEN MODIFY DIACHI VARCHAR2(4000 BYTE);
ALTER TABLE DuLieu.HOCVIEN MODIFY SDT VARCHAR2(4000 BYTE);

ALTER TABLE DuLieu.NHANVIEN MODIFY MATKHAU VARCHAR2(500 BYTE);
ALTER TABLE DuLieu.NHANVIEN MODIFY EMAIL VARCHAR2(500 BYTE);
ALTER TABLE DuLieu.NHANVIEN MODIFY SDT VARCHAR2(500 BYTE);
GRANT DBA TO DuLieu;
SELECT * FROM DuLieu.GIAOVIEN
UPDATE DuLieu.NHANVIEN
SET MATKHAU = 'Password123'
WHERE TENTKNV = 'Testne1'

UPDATE DuLieu.NHANVIEN 
SET MATKHAU = 'PASSWORD123' 
WHERE TENTKNV = 'QUANLYTIENGANH';

SELECT * FROM DuLieu.NHANVIEN

INSERT INTO NHANVIEN VALUES ('QUANLYTIENGANH','password123','qltienganh@gmail.com','09789734124');

QUANLYTIENGANH                		qltienganh@gmail.com
Testne                        		test@gmail.com
Testne1                       		test2@gmail.com
NV002                         		nv002@gmail.com
NV003                         		NV003@gmail.com
NV001                         		nv001@gmail.com

SELECT * FROM DuLieu.HOCVIEN;
SELECT * FROM PHANLOP;
SELECT * FROM HOADON;
GRANT SELECT, INSERT, UPDATE ON DuLieu.NHANVIEN TO quanlyTiengAnh;


---AUDIT---